# Debian 12 (Bookworm) 基础镜像配置
name: debian12-base
description: Debian 12 (Bookworm) 基础镜像
version: "1.0.0"

source:
  amd64: https://cloud.debian.org/images/cloud/bookworm/latest/debian-12-genericcloud-amd64.qcow2
  arm64: https://cloud.debian.org/images/cloud/bookworm/latest/debian-12-genericcloud-arm64.qcow2

disk:
  size: 10G

settings:
  timezone: Asia/Shanghai
  locale: en_US.UTF-8
  hostname: debian12

apt:
  mirror: https://mirrors.tuna.tsinghua.edu.cn/debian
  security: https://mirrors.tuna.tsinghua.edu.cn/debian-security

packages:
  - vim
  - curl
  - wget
  - git
  - htop
  - tmux
  - net-tools
  - ca-certificates
  - gnupg
  - qemu-guest-agent
  - cloud-guest-utils
  - socat
  - jq
  - tree
  - bash-completion
  - lsof
  - netcat-openbsd
  - ethtool
  - iptables

users:
  - name: root
    password_env: ROOT_PASSWORD
  - name: debian
    password_env: ROOT_PASSWORD
    sudo: NOPASSWD:ALL
    ssh_key_env: SSH_PUBLIC_KEY

ssh:
  password_auth: true
  root_login: true

files:
  - path: /etc/motd
    content: |
      ╔═══════════════════════════════════════════════════════════╗
      ║        Debian 12 (Bookworm) - Gclm Team                   ║
      ╚═══════════════════════════════════════════════════════════╝
    permissions: "0644"

  - path: /etc/sysctl.d/99-custom.conf
    content: |
      net.ipv4.ip_forward=0
      net.ipv6.conf.all.disable_ipv6=1
      fs.inotify.max_user_instances=512
      fs.inotify.max_user_watches=262144
    permissions: "0644"

commands:
  - systemctl enable qemu-guest-agent
  - systemctl start qemu-guest-agent
  - update-alternatives --set editor /usr/bin/vim.basic
